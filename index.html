<!DOCTYPE HTML>
<html lang="en">
<head>
	<title>hpfriends - real-time social data-sharing</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=792, user-scalable=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<link rel="stylesheet" href="shower/themes/ribbon/styles/screen.css">

	<style>
    @import url(http://fonts.googleapis.com/css?family=Inconsolata:400,700);
    body {
      /* prevent "flickering" between aliased/antialiased display */
      -webkit-backface-visibility: hidden;
    }
    #Cover iframe {
      position: absolute;
      top: 0;
      left: 0;
      z-index: -1;
      width: 100%;
      height: 100%;
    }
		#Cover h2 {
			margin:100px 0 0;
			color:#FFF;
			text-align:center;
			font-size:70px;
      text-shadow: 2px 2px #000000;
			}
		#Cover p {
			margin:10px 0 0;
			text-align:center;
			color:#FFF;
			font-style:italic;
			font-size:20px;
      text-shadow: 2px 2px #000000;
			}
			#Cover p a {
				color:#FFF;
				}
		#Picture h2 {
			color:#FFF;
			}
		#SeeMore h2 {
			font-size:100px
			}
		#SeeMore img {
			width:0.72em;
			height:0.72em;
			}
    h3 {
      font: 25px 'PT Sans Narrow', sans-serif;
      font-weight: normal;
      color: #666;
    }
    li {
      margin-bottom: -10px;
    }
    p {
      margin-bottom: 0px;
    }
    ol.bare li:before, ul.bare li:before {
      content: none;
    }
    ol.bare li, ul.bare li {
      margin-left: 50px;
    }
    ul li ul li, small {
      font-size: 80%;
    }
    tt {
      font-family: "Inconsolata", sans-serif;
    }
    .center {
      text-align: center;
      margin-left: auto;
      margin-right: auto;
      display: block;
      margin-top: -10px;
    }

    ol.big li, ul.big li {
      margin-bottom: 0px;
    }
	</style>
</head>

<body class="list">
	<header class="caption">
		<h1>hpfriends - real-time social data-sharing</h1>
		<p></p>
	</header>
	<section class="slide cover" id="Cover"><div style="margin-top: 50px;">
		<h2>hpfriends - real-time social data-sharing</h2>
		<p>SIGINT 2013 presentation by Mark <a href="https://twitter.com/repmovsb">'rep'</a> Schloesser and Johannes <a href="https://twitter.com/heipei">'heipei'</a> Gilger</p>
		<img src="pictures/graph1.png" alt="">
	</div></section>

	<section class="slide"><div>
		<h2>Outline</h2>
    <img style="display: inline; float: right; height: 250px" src="gfx/clipboard.png">
		<ol>
			<li>About us</li>
			<li>Motivation</li>
			<li>hpfeeds</li>
			<li>hpfriends</li>
			<li>Technology</li>
		</ol>
	</div></section>

	<section class="slide"><div>
		<h2>About us</h2>
      <div>
      <img style="display: inline; float: right; height: 150px" src="pictures/mark.png">
      <img style="display: inline; float: right; height: 30px; margin-right: 10px;" src="gfx/rapid7.jpg">
      <h3>Mark 'rep' Schloesser</h3>
        <ul>
          <li>Malware researcher at Rapid7</li>
          <li>Honeynet member since 2008</li>
        </ul>
      </div>
      <div style="display: block">
      <img style="display: inline; float: right; height: 150px" src="pictures/jojo.jpg">
      <img style="display: inline; float: right; height: 30px; margin-right: 10px;" src="gfx/rwth.png">
      <h3>Jojo 'heipei' Gilger</h3>
        <ul>
          <li>PhD student, IT-Security, RWTH Aachen University</li>
          <li>Honeynet member since 2012</li>
        </ul>
      </div>

	</div></section>

	<section class="slide"><div>
		<h2>ITSec @ RWTH</h2>
      <div>
      <img style="height: 230px" src="gfx/itsec_team.jpg">
      <img style="height: 230px" src="gfx/rwthctf.jpg">
        <ul>
          <li>Lectures: ITSec 1+2, Mobile Security, Security in Wireless Networks</li>
          <li>Lab: Security Lab (Hands-on practical offensive security)</li>
          <li>CTF: 0ldeur0pe, rwthCTF 2011 &amp; 2012</li>
        </ul>
        <p style="text-align: center; margin-top: -60px;"><a href="http://itsec.rwth-aachen.de">itsec.rwth-aachen.de</a></p>
      </div>
	</div></section>

	<section class="slide"><div>
		<h2>The Honeynet Project</h2>
		<figure>
			<blockquote>
				<p>
        The Honeynet Project is a leading international 501c3 non-profit security research organization, dedicated to investigating the latest attacks and developing open source security tools to improve Internet security.
      </p>
			</blockquote>
		</figure>
   <img src="gfx/honeynet.png" style="float: right; display: inline; height: 50px; margin-top: 10px">
    Homepage: <a href="http://honeynet.org">honeynet.org</a>
    </div>
	</div></section>

	<section class="slide"><div>
		<h2>Motivation: Sharing stuff</h2>
		<figure class="next">
			<blockquote>
				<p>Hey Mark, can I have (real-time) access to the malware hitting your sensors?</p>
			</blockquote>
			<figcaption>Jojo</figcaption>
		</figure>

		<figure class="next">
			<blockquote>
				<p>Hey Jojo, can you give me access to the samples you get from Mark?</p>
			</blockquote>
			<figcaption>Other people</figcaption>
		</figure>

		<figure class="next">
			<blockquote>
				<p>Sure, let me just ask the admin to give you access to the channel...</p>
			</blockquote>
			<figcaption>Jojo (probably not the last time)</figcaption>
		</figure>
	</div></section>

	<section class="slide"><div>
		<h2>Motivation: The HoneyMap</h2>
    <iframe src="http://map.honeycloud.net" style="width: 100%; height: 78%; margin-top: -30px;" scrolling="no"></iframe>
  </div></section>

	<section class="slide"><div>
		<h2>Available options for sharing data</h2>
    <h3>The usual suspects...</h3>
		<img src="gfx/cables.jpg" style="float: right; display: inline; height: 200px; margin-left: 10px">
		<ul class="next">
      <li>Batch: FTP, E-Mail, scp, One-click hoster ...</li>
      <li>Real-time: XMPP, HTTP submission</li>
    </ul>
    <h3 class="next">... with their common problems.</h3>
    <ul class="next">
      <li>Naming and formatting of data. Channels?</li>
      <li>Authentication? Access Control?</li>
      <li>Protocol and management overhead?</li>
    </ul>
	</div></section>

	<section class="slide"><div>
		<h2>Honeynet Generic Datafeeds</h2>
		<img src="gfx/generic_feeds.png" style="text-align:center; display: inline; height: 80%; margin-top: -20px; margin-left: auto; margin-right: auto;">
  </div></section>

	<section class="slide"><div>
		<h2>The hpfeeds protocol</h2>
    <p><i>hpfeeds</i> is an authenticated publish/subscribe datafeed protocol (by Mark) used by the <a
    href="http://honeynet.org/">Honeynet Project</a>. It supports channels and authkeys.</p>
    <ul class="next">
      <li>Channel permissions on central webif connected to the broker</li>
      <li>Access Control via Authkeys, rather than users</li>
      <li>Simple wire-format, easy to implement and use</li>
      <li>Implementations for hpfeeds exist for Python, Go, Ruby and JavaScript
      </li>
    </ul>
    <!--
   	<p class="next" style="text-align: center"><b>Only problem</b>: Management overhead for channel access control.</p>
    -->
	</div></section>

	<section class="slide"><div>
		<h2>hpfeeds - details</h2>
    <ul class="next">
      <li>Five protocol message types: <tt> PUB, SUB, ERROR, INFO, AUTH</tt></li>
      <li>Central feedbroker on server, reference client utility</li>
      <li>Submission modules for Dionaea, Glastopf and Kippo</li>
      <img src="gfx/hpfeeds.png" style="float: right; display: inline; height: 250px; margin-top: 10px">
      <li>Statistics sink</li>
      <li>Webinterface for managing ACLs</li>
    </ul>
	</div></section>

	<section class="slide"><div>
		<h2>hpfeeds - pros &amp; cons</h2>
    <h3>Pros</h3>
    <ul class="next bare">
      <li><b style="color: green">+</b> Easy data sharing, more people using it inside HoneyNet project</li>
      <li><b style="color: green">+</b> Software support improving steadily</li>
      <li><b style="color: green">+</b> Even third parties are interested</li>
    </ul>
    <h3 class="next">Cons</h3>
    <ul class="next bare">
      <li><b style="color: red">-</b> Channels are global (only one <tt>dionaea.capture</tt> channel)</li>
      <li><b style="color: red">-</b> Management of access control falls back to central admin (== Mark)</li>
    </ul>
	</div></section>

	<section class="slide"><div>
		<h2>So what would we need?</h2>
      <p>A system for large-scale real-time data-sharing would have to ...
      <ol class="big bare">
        <li class="next"><img src="gfx/time.png" style="position: relative; top: 14px;"/> be real-time (duh!)</li>
        <li class="next"><img src="gfx/pub.png" style="position: relative; top: 14px;"/> follow simple pub/sub principles</li>
        <li class="next"><img src="gfx/access.png" style="position: relative; top: 14px;"/> allow for distributed and natural access control</li>
      </li>
	</div></section>

	<section class="slide"><div>
		<h2>Distributed Access Control</h2>
    <p>Managing permissions for a large number of users does not scale and also
    does not correspond to the way we collaborate. Think "Web of Trust" and
    "Distributed Version Control" (like with git).</p>
    <p class="next" style="text-align: center; font-size: 200%;"><i>Social</i> is the solution!</p>
	</div></section>

	<section class="slide"><div>
		<h2>hpfriends</h2>
    <p><i>hpfriends</i> is an evolution of the hpfeeds system. The wire-format
    is identical, the message broker behaves the same way. The big difference
    is the data-sharing model and the backend software.</p>
	</div></section>

	<section class="slide"><div>
		<h2>hpfriends - unique features</h2>
    <p style="line-height: 1.3;"><i>hpfriends</i> supports users and groups. These are connected by
    sharing relations, representing a web of trust between users who trust each
    other by sharing their own data as well as data received by third parties.</p>
    <embed src="gfx/sharing.svg" type="image/svg+xml" style="text-align: center; display: block; margin-left: auto; margin-right: auto; height: 50%"/>
  </div></section>

	<section class="slide"><div>
		<h2>hpfriends - social graph</h2>
    <img src="gfx/jojo_graph.png" style="float: right; display: inline; height: 50%; margin-left: 10px;">
    <p style="line-height: 1.3;"><i>hpfriends</i> operates on a social graph. Users and groups are nodes, sharing relations are edges.<br/><br/>
    Edges between users have a <i>type</i> (<tt>shares, shares_all</tt>) and an <i>attribute</i>, i.e. the channel name.<br/><br/>
    Group membership is also stored as an edge between a user and group.</p>
  </div></section>

	<section class="slide"><div>
		<h2>hpfriends - channels</h2>
    <p style="line-height: 1.3;"><i>Channels</i> behave quite differently than in the original hpfeeds.</p>
    <ul>
      <li>I can publish on any channel-name I like</li>
      <li>I can add sharing-relationships with groups or people</li>
      <li>Each user can decide whether to accept the share I am offering</li>
    </ul>
    <img src="gfx/accept.png" style="display: inline; width: 100%">
  </div></section>

	<section class="slide"><div>
		<h2>hpfriends - demo time!</h2>
    <p style="line-height: 1.3;">We're going to show you ...</p>
    <img type="image/svg+xml" src="gfx/terminal.svg" style="float: right; display: inline; height: 164px"/>
    <ol class="big">
      <li>A simple 1:1 data sharing scenario</li>
      <li>A scenario where data is also relayed to a third party</li>
      <li>The way the HoneyMap works behind the scenes</li>
    </ul>
  </div></section>

	<section class="slide"><div>
		<h2>hpfriends - implementation</h2>
    <img style="display: inline; float: left; height: 80px; margin-right: 10px; " src="gfx/neo4j.png">
    <p style="line-height: 1.3;">Currently, <i>hpfriends</i> uses the Neo4j graph database to store user, group and sharing information. Further information on users / etc is stored within MongoDB.</p>
    <img src="gfx/graph_stats.png" style="margin-left: auto; margin-right: auto; margin-bottom: 10px; display: block; width: 100%">
    <small class="center">Screenshot from Neo4j interface</small>

    <p style="line-height: 1.3; margin-top: 10px;">For actual message delivery via the feedbroker, sharing relationships are cached for 5-minute intervals for performance.</p>
  </div></section>

	<section class="slide"><div>
		<h2>hpfriends - Neo4j query</h2>
    <pre><code style="font-size: 70%">
start usrc=node({srcid}), udst=node({subids})
        match p=usrc-[:*1..]->udst, udst-[ra:accepts]->umid
        with relationships(p) as rs, udst as udst, ra as ra
        where id(last(rs)) = ra.sid
        return distinct udst'''
</code></pre>
    </div></section>

	<section class="slide"><div>
		<h2>hpfriends - frontend</h2>
    <p style="line-height: 1.3;">Public hpfriends webif is at <a
    href="http://hpfriends.honeycloud.net">hpfriends.honeycloud.net</a>. The webif was built using Meteor, a real-time
    JavaScript / NodeJS web-framework which takes care of data persistence &amp; synchronization, data binding to the
    UI, templating, latency compensation and many other things.</p>
    <embed src="gfx/html5.svg" type="image/svg+xml" style="text-align: right; display: inline; float: right; height: 30%"/>
    <ul>
      <li>CoffeeScript with Handlebars templating</li>
      <li>MongoDB and Neo4j queries in the background</li>
      <li>Web 2.0 stuff: Twitter Bootstrap, Webfonts, Websockets ...</li>
    </ul>
  </div></section>

	<section class="slide"><div>
		<h2>hpfriends - hpfeeds wire format</h2>
    <pre><code>struct MsgHeader {
  uint32_t <mark>messageLength</mark>; <mark class="comment">// total length</mark>
  uint8_t <mark>opCode</mark>; <mark class="comment">// currently five opCodes implemented</mark>
};</code></pre>
    <pre><code style="font-size: 70%; line-height: 1.1">length | opcode | next | identifier | next | channelname | payload
--------------------------------------------------------------------------
    85        3   9      b4aa2@hp1    9      mwcapture     137941a3d8589f9
    </pre></code>
  <p class="center" style="margin-top: -25px">Full documentation and list of opCodes at <a href="https://github.com/rep/hpfeeds">github/rep/hpfeeds</a>.</p>
  </div></section>

	<section class="slide"><div>
		<h2>hpfriends - Software support</h2>
      <ul class="big">
        <li><b><a href="http://dionaea.carnivore.it/">dionaea</a></b> (server honeypot): branch which has hpfeeds integration</li>
        <img src="gfx/honeynet.png" style="float: right; display: inline; height: 50px; margin-top: 10px">
        <li><b><a href="https://code.google.com/p/kippo/">kippo</a></b> (medium-interaction ssh honeypot): rudimentary</li>
        <li><b><a href="http://buffer.github.io/thug/">thug</a></b> (low-interaction honeyclient): hpfeeds integrated</li>
      </ul>
      <p class="center"><i>Your software as well?</i></p>
  </div></section>

	<section class="slide"><div>
		<h2>hpfriends - links</h2>
    <ul>
      <li><b>hpfriends</b> at <a href="http://hpfriends.honeycloud.net">hpfriends.honeycloud.net</a>
        <ul>
          <li>Free to use, source not open (yet)</li>
          <li>Consider contributing bug-reports / feature ideas!</li>
        </ul>
      </li>
      <li>Guide on how to use hpfriends at <a href="http://heipei.github.io/">heipei.github.io</a></li>
      <li><b>hpfeeds</b> repo and documentation at <a href="https://github.com/rep/hpfeeds">github.com/rep/hpfeeds</a></li>
        <ul><li><small>Thanks to Florian Weingarten for Ruby / Go implementation</small></li></ul></li>
      <li>The <b>HoneyMap</b> at <a href="http://map.honeynet.org/">map.honeynet.org</a></li>
    </ul>
	</div></section>

	<section class="slide"><div>
    <p style="text-align: center; font-size: 200%;">Thank you for listening!</p>
    <p style="text-align: center;">Follow-up questions to<br/> 
    <a href="mailto:ms@mwcollect.org">Mark</a>  - <img src="gfx/twitter.png"/ style="height: 30px; position: relaitve; top: 15px; margin-top: 5px"> repmovsb<br/>
    <a href="mailto:heipei@hackvalue.de">Jojo</a> - <img src="gfx/twitter.png"/ style="height: 30px; margin-top: 5px"> heipei<br/>
    </p>
    
	</div></section>

	<div class="progress"><div></div></div>
	<script src="shower/shower.min.js"></script>
	<!-- Copyright Â© 2013 Yours Truly, Famous Inc. -->
</body>
</html>
